/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/library","sap/f/library","sap/ui/core/Control","sap/m/Text","sap/f/Avatar","sap/ui/Device","sap/ui/model/json/JSONModel","sap/f/cards/HeaderRenderer","sap/f/cards/IconFormatter","sap/ui/core/Core","sap/f/cards/loading/LoadingProvider"],function(t,e,i,a,r,s,o,n,d,h,l){"use strict";var g=t.AvatarShape;var p=i.extend("sap.f.cards.Header",{metadata:{library:"sap.f",interfaces:["sap.f.cards.IHeader"],properties:{title:{type:"string",defaultValue:""},subtitle:{type:"string",defaultValue:""},statusText:{type:"string",defaultValue:""},iconDisplayShape:{type:"sap.m.AvatarShape",defaultValue:g.Circle},iconSrc:{type:"sap.ui.core.URI",defaultValue:""},iconInitials:{type:"string",defaultValue:""}},aggregations:{toolbar:{type:"sap.ui.core.Control",multiple:false},_title:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_subtitle:{type:"sap.m.Text",multiple:false,visibility:"hidden"},_avatar:{type:"sap.f.Avatar",multiple:false,visibility:"hidden"}},events:{press:{}}}});p.prototype.init=function(){this._oRb=h.getLibraryResourceBundle("sap.f");this._aReadyPromises=[];this._bReady=false;this._awaitEvent("_dataReady");this._awaitEvent("_actionHeaderReady");Promise.all(this._aReadyPromises).then(function(){this._bReady=true;this.fireEvent("_ready")}.bind(this));this._oLoadingProvider=new l};p.prototype.exit=function(){this._oServiceManager=null;this._oDataProviderFactory=null;this._oRb=null;if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null}if(this._oActions){this._oActions.destroy();this._oActions=null}if(this._oLoadingProvider){this._oLoadingProvider.destroy();this._oLoadingProvider=null}};p.prototype._awaitEvent=function(t){this._aReadyPromises.push(new Promise(function(e){this.attachEventOnce(t,function(){e()})}.bind(this)))};p.prototype.isReady=function(){return this._bReady};p.prototype._getTitle=function(){var t=this.getAggregation("_title");if(!t){t=new a({maxLines:3}).addStyleClass("sapFCardTitle");this.setAggregation("_title",t)}return t};p.prototype._getSubtitle=function(){var t=this.getAggregation("_subtitle");if(!t){t=new a({maxLines:2}).addStyleClass("sapFCardSubtitle");this.setAggregation("_subtitle",t)}return t};p.prototype._getAvatar=function(){var t=this.getAggregation("_avatar");if(!t){t=(new r).addStyleClass("sapFCardIcon");this.setAggregation("_avatar",t)}return t};p.prototype.onBeforeRendering=function(){this._getTitle().setText(this.getTitle());this._getSubtitle().setText(this.getSubtitle());this._getAvatar().setDisplayShape(this.getIconDisplayShape());this._getAvatar().setSrc(this.getIconSrc());this._getAvatar().setInitials(this.getIconInitials())};p.prototype._getHeaderAccessibility=function(){var t=this._getTitle()?this._getTitle().getId():"",e=this._getSubtitle()?this._getSubtitle().getId():"",i=this.getStatusText()?this.getId()+"-status":"",a=this._getAvatar()?this._getAvatar().getId():"";return t+" "+e+" "+i+" "+a};p.prototype.onAfterRendering=function(){if(s.browser.msie){if(this.getTitle()){this._getTitle().clampText()}if(this.getSubtitle()){this._getSubtitle().clampText()}}};p.prototype.ontap=function(t){var e=t.srcControl;if(e&&e.getId().indexOf("overflowButton")>-1){return}this.firePress()};p.prototype.onsapselect=function(){this.firePress()};p.prototype.setServiceManager=function(t){this._oServiceManager=t;return this};p.prototype.setDataProviderFactory=function(t){this._oDataProviderFactory=t;return this};p.prototype._setData=function(t){var e="/";if(t&&t.path){e=t.path}this.bindObject(e);if(this._oDataProvider){this._oDataProvider.destroy()}this._oDataProvider=this._oDataProviderFactory.create(t,this._oServiceManager);this._oLoadingProvider.createLoadingState(this._oDataProvider);if(this._oDataProvider){this.setModel(new o);this._oDataProvider.attachDataChanged(function(t){this._updateModel(t.getParameter("data"))}.bind(this));this._oDataProvider.attachError(function(t){this._handleError(t.getParameter("message"))}.bind(this));this._oDataProvider.triggerDataUpdate().then(function(){this.fireEvent("_dataReady");this._oLoadingProvider.setLoading(false);this._oLoadingProvider.removeHeaderPlaceholder(this)}.bind(this))}else{this.fireEvent("_dataReady")}};p.prototype._setAccessibilityAttributes=function(t){if(!t.actions){this._sAriaRole="heading";this._sAriaHeadingLevel="3";this._sAriaRoleDescritoion=this._oRb.getText("ARIA_ROLEDESCRIPTION_CARD_HEADER")}else{this._sAriaRole="button";this._sAriaHeadingLevel=undefined;this._sAriaRoleDescritoion=this._oRb.getText("ARIA_ROLEDESCRIPTION_INTERACTIVE_CARD_HEADER")}};p.prototype._updateModel=function(t){this.getModel().setData(t)};p.prototype._handleError=function(t){this.fireEvent("_error",{logMessage:t})};p.prototype.isLoading=function(){var t=this._oLoadingProvider,e=this.getParent(),i=e.getMetadata()._sClassName==="sap.ui.integration.widgets.Card"?e.isLoading():false;return!t.getDataProviderJSON()&&(t.getLoadingState()||i)};return p});