/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/model/json/JSONModel","sap/ui/base/ManagedObjectObserver","sap/f/cards/loading/LoadingProvider"],function(t,e,i,a){"use strict";var r=t.extend("sap.f.cards.BaseContent",{metadata:{library:"sap.f",aggregations:{_content:{multiple:false,visibility:"hidden"}},events:{press:{}}},renderer:function(t,e){var i="sapFCard";var a=e.getMetadata().getLibraryName();var o=e.getMetadata().getName();var n=o.slice(a.length+1,o.length);var s=e.getParent();i+=n;t.write("<div");t.writeElementData(e);t.addClass(i);t.addClass("sapFCardBaseContent");t.writeClasses();if(s&&s.isA("sap.f.ICard")&&s.getHeight()==="auto"){var d=r.getMinHeight(n,e.getConfiguration(),e);t.addStyle("min-height",d)}t.writeStyles();t.write(">");if(n!=="AdaptiveContent"&&e.isLoading()){t.renderControl(e._oLoadingPlaceholder)}t.renderControl(e.getAggregation("_content"));t.write("</div>")}});r.prototype.init=function(){this._iWaitingEventsCount=0;this._bReady=false;this._mObservers={};this._awaitEvent("_dataReady");this._awaitEvent("_actionContentReady");this._oLoadingProvider=new a};r.prototype.ontap=function(t){if(!t.isMarked()){this.firePress({})}};r.prototype.exit=function(){this._oServiceManager=null;this._oDataProviderFactory=null;this.destroyPlaceholder();if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null}if(this._oActions){this._oActions.destroy();this._oActions=null}if(this._oLoadingProvider){this._oLoadingProvider.destroy();this._oLoadingProvider=null}};r.prototype.getActions=function(){return this._oActions};r.prototype.setActions=function(t){this._oActions=t};r.prototype._awaitEvent=function(t){this._iWaitingEventsCount++;this.attachEventOnce(t,function(){this._iWaitingEventsCount--;if(this._iWaitingEventsCount===0){this._bReady=true;this.fireEvent("_ready")}})};r.prototype.destroy=function(){this.setAggregation("_content",null);this.setModel(null);this._iWaitingEventsCount=0;if(this._mObservers){Object.keys(this._mObservers).forEach(function(t){this._mObservers[t].disconnect();delete this._mObservers[t]},this)}return t.prototype.destroy.apply(this,arguments)};r.prototype.setConfiguration=function(t,e){this._oConfiguration=t;if(!t){return this}this._oLoadingPlaceholder=this._oLoadingProvider.createContentPlaceholder(t,e);this._setData(t.data);return this};r.prototype.getConfiguration=function(){return this._oConfiguration};r.prototype._setData=function(t){var i="/";if(t&&t.path){i=t.path}this.bindObject(i);if(this._oDataProvider){this._oDataProvider.destroy()}if(this._oDataProviderFactory){this._oDataProvider=this._oDataProviderFactory.create(t,this._oServiceManager)}this._oLoadingProvider.createLoadingState(this._oDataProvider);if(this._oDataProvider){this.setModel(new e);this._oDataProvider.attachDataChanged(function(t){this._updateModel(t.getParameter("data"));this.onDataChanged()}.bind(this));this._oDataProvider.attachError(function(t){this._handleError(t.getParameter("message"))}.bind(this));this._oDataProvider.triggerDataUpdate().then(function(){this.fireEvent("_dataReady");this.destroyPlaceholder()}.bind(this))}else{this.fireEvent("_dataReady")}};r.prototype.destroyPlaceholder=function(){if(this._oLoadingPlaceholder){this._oLoadingPlaceholder.destroy();this._oLoadingPlaceholder=null}};r.prototype.onDataChanged=function(){};function o(t,e,a){var r=this.getBindingContext(),o=e.getAggregation(t);if(r){a.path=a.path||r.getPath();e.bindAggregation(t,a);if(this.getModel("parameters")&&o){this.getModel("parameters").setProperty("/visibleItems",o.length)}if(!this._mObservers[t]){this._mObservers[t]=new i(function(i){if(i.name===t&&(i.mutation==="insert"||i.mutation==="remove")){var a=e.getAggregation(t);var r=a?a.length:0;if(this.getModel("parameters")){this.getModel("parameters").setProperty("/visibleItems",r)}}}.bind(this));this._mObservers[t].observe(e,{aggregations:[t]})}}}r.prototype._bindAggregation=function(t,e,i){var a=t&&typeof t==="string";var r=i&&typeof i==="object";if(!a||!e||!r){return}if(this.getBindingContext()){o.apply(this,arguments)}else{e.attachModelContextChange(o.bind(this,t,e,i))}};r.prototype.isReady=function(){return this._bReady};r.prototype._updateModel=function(t){this.getModel().setData(t)};r.prototype._handleError=function(t){this.fireEvent("_error",{logMessage:t})};r.prototype.setServiceManager=function(t){this._oServiceManager=t;return this};r.prototype.setDataProviderFactory=function(t){this._oDataProviderFactory=t;return this};r.getMinHeight=function(t,e,i){var a=5,o,n=i,s=i.getParent();if(!i.getDomRef()&&s&&s.isA("sap.f.ICard")){n=s}var d=n.$().closest(".sapUiSizeCompact").hasClass("sapUiSizeCompact");if(jQuery.isEmptyObject(e)){return"0rem"}switch(t){case"ListContent":o=r._getMinListHeight(e,d);break;case"TableContent":o=r._getMinTableHeight(e,d);break;case"TimelineContent":o=r._getMinTimelineHeight(e,d);break;case"AnalyticalContent":o=14;break;case"AnalyticsCloudContent":o=14;break;case"ObjectContent":o=0;break;default:o=0}return(o!==0?o:a)+"rem"};r._getMinListHeight=function(t,e){var i=parseInt(t.maxItems)||0,a=t.item,r=e?2:2.75;if(!a){return 0}if(a.description){r=5}return i*r};r._getMinTableHeight=function(t,e){var i=parseInt(t.maxItems)||0,a=e?2:2.75,r=e?2:2.75;return i*a+r};r._getMinTimelineHeight=function(t,e){var i=parseInt(t.maxItems)||0,a=e?4:5;return i*a};r.prototype.isLoading=function(){var t,e=this.getParent();t=this._oLoadingProvider;return!t.getDataProviderJSON()&&(t.getLoadingState()||e.isLoading())};return r});