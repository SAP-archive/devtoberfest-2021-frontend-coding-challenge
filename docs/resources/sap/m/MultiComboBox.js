/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./InputBase","./ComboBoxTextField","./ComboBoxBase","./Tokenizer","./Token","./List","./StandardListItem","./Popover","./GroupHeaderListItem","./library","sap/ui/core/EnabledPropagator","sap/ui/core/IconPool","sap/ui/core/library","sap/ui/Device","sap/ui/core/Item","sap/ui/core/SeparatorItem","sap/ui/core/ResizeHandler","./MultiComboBoxRenderer","sap/ui/dom/containsOrEquals","sap/m/inputUtils/completeTextSelected","sap/m/inputUtils/inputsDefaultFilter","sap/m/inputUtils/typeAhead","sap/m/inputUtils/ListHelpers","sap/m/inputUtils/filterItems","sap/m/inputUtils/itemsVisibilityHandler","sap/m/inputUtils/selectionRange","sap/m/inputUtils/calculateSelectionStart","sap/m/inputUtils/forwardItemPropertiesToToken","sap/m/inputUtils/getTokenByItem","sap/ui/events/KeyCodes","sap/base/util/deepEqual","sap/base/assert","sap/base/Log","sap/ui/core/Core","sap/ui/core/InvisibleText","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/cursorPos","sap/ui/dom/jquery/control"],function(e,t,i,s,n,o,r,a,l,h,u,c,g,p,d,f,m,I,y,v,_,S,k,T,b,C,E,P,V,A,O,D,L,x,F,R){"use strict";var B=h.ListMode;var z=g.ValueState;var M=g.OpenState;var w=h.TokenizerRenderMode;var K=i.extend("sap.m.MultiComboBox",{metadata:{library:"sap.m",designtime:"sap/m/designtime/MultiComboBox.designtime",properties:{selectedKeys:{type:"string[]",group:"Data",defaultValue:[]},hasSelection:{type:"boolean",visibility:"hidden",defaultValue:false}},associations:{selectedItems:{type:"sap.ui.core.Item",multiple:true,singularName:"selectedItem"}},aggregations:{tokenizer:{type:"sap.m.Tokenizer",multiple:false,visibility:"hidden"}},events:{selectionChange:{parameters:{changedItem:{type:"sap.ui.core.Item"},changedItems:{type:"sap.ui.core.Item[]"},selected:{type:"boolean"},selectAll:{type:"boolean"}}},selectionFinish:{parameters:{selectedItems:{type:"sap.ui.core.Item[]"}}}},dnd:{draggable:false,droppable:true}}});c.insertFontFaceStyle();u.apply(K.prototype,[true]);K.prototype.clone=function(e){var t=i.prototype.clone.apply(this,arguments),s=this._getList();if(s){t.syncPickerContent()}return t};K.prototype.open=function(){if(!this.isOpen()){this._bPickerIsOpening=true}this.syncPickerContent();return i.prototype.open.apply(this,arguments)};K.prototype.onsapend=function(e){if(e.isMarked("forwardFocusToParent")){this.focus()}};K.prototype.onsaphome=function(e){if(!this.getFocusDomRef().selectionStart&&this._hasTokens()){s.prototype.onsaphome.apply(this.getAggregation("tokenizer"),arguments)}e.setMarked()};K.prototype.onsapdown=function(e){if(!this.getEnabled()||!this.getEditable()){return}e.setMarked();e.preventDefault();this.syncPickerContent();if(!this.isOpen()){this._oTraversalItem=this._getNextTraversalItem();if(this._oTraversalItem&&!this.isFocusInTokenizer()&&!this.isComposingCharacter()){this.updateDomValue(this._oTraversalItem.getText());this.selectText(0,this.getValue().length)}return}if(this.getValueState()!=z.None){this._handleFormattedTextNav();return}setTimeout(function(){var e=k.getVisibleItems(this.getItems()),t=e[0];t&&k.getListItem(t).focus()}.bind(this),0)};K.prototype.onsapup=function(e){if(!this.getEnabled()||!this.getEditable()){return}e.setMarked();e.preventDefault();this.syncPickerContent();if(this.isFocusInTokenizer()||this.isOpen()){return}this._oTraversalItem=this._getPreviousTraversalItem();if(this._oTraversalItem){this.updateDomValue(this._oTraversalItem.getText());this.selectText(0,this.getValue().length)}};K.prototype.isFocusInTokenizer=function(){return R.contains(this.getAggregation("tokenizer").getFocusDomRef(),document.activeElement)};K.prototype.onsapshow=function(e){this._handleItemToFocus();i.prototype.onsapshow.apply(this,arguments)};K.prototype._handlePopupOpenAndItemsLoad=function(){this._handleItemToFocus();i.prototype._handlePopupOpenAndItemsLoad.apply(this,arguments)};K.prototype._valueStateNavDelegate=function(e,t,i){var s=this.getFocusDomRef();this.oValueStateNavDelegate={onsapdown:function(e){var t=k.getVisibleItems(this.getItems()),i=t.length&&k.getListItem(t[0]);e.preventDefault();i&&i.focus()}.bind(this),onsapup:function(){s.focus()},onsapend:function(e){var t=k.getVisibleItems(this.getItems()),i=t.length&&k.getListItem(t[t.length-1]);e.preventDefault();i&&i.focus()}.bind(this),onfocusout:function(t){e.removeStyleClass("sapMFocusable");if(!e.getDomRef().contains(t.relatedTarget)){i.forEach(function(e){e.getDomRef().setAttribute("tabindex","-1")})}}};return this.oValueStateNavDelegate};K.prototype._closePickerDelegate={onsaptabnext:function(){this.close();setTimeout(function(){this.closeValueStateMessage()}.bind(this),0)}};K.prototype._formattedTextLinksNav={onsapup:function(){this.focus()},onsapdown:function(){var e=k.getSelectableItems(this.getItems());if(e.length){e[0].focus()}}};K.prototype._handleFormattedTextNav=function(){var e=this.getPicker().getCustomHeader(),t=this.getValueStateLinks(),i=e.getFormattedText(),s=this.oValueStateNavDelegate||this._valueStateNavDelegate(e,i,t),n=t?t[t.length-1]:null,o=t?t[0]:null;if(!e.getDomRef()||e.getDomRef()===document.activeElement){return}e.getDomRef().setAttribute("tabindex","-1");e.addDelegate(s);e.addStyleClass("sapMFocusable");e.focus();t.forEach(function(e){e.getDomRef().setAttribute("tabindex","0");e.addDelegate(this._formattedTextLinksNav,this)},this);this.oMoveFocusBackToVSHeader=!this.oMoveFocusBackToVSHeader?{onsaptabprevious:function(t){t.preventDefault();e.focus();e.addStyleClass("sapMFocusable")}}:this.oMoveFocusBackToVSHeader;n&&n.addDelegate(this._closePickerDelegate,this);o&&o.addDelegate(this.oMoveFocusBackToVSHeader,this)};K.prototype.onsaphide=K.prototype.onsapshow;K.prototype._selectItemByKey=function(e){var t,i,s,n,o,r,a=this.isOpen();if(!this.getEnabled()||!this.getEditable()){return}if(e){e.setMarked()}t=this._getUnselectedItems(a?"":this.getValue());for(n=0;n<t.length;n++){r=!(t[n].getKey()===undefined||t[n].getKey()===null)&&!t[n].isA("sap.ui.core.SeparatorItem");if(t[n].getText().toUpperCase()===this.getValue().toUpperCase()&&r){s=t[n];o=true;break}}if(o){i={item:s,id:s.getId(),key:s.getKey(),fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true,listItemUpdated:false};this._bPreventValueRemove=false;if(this.getValue()===""||typeof this.getValue()==="string"&&s.getText().toLowerCase().startsWith(this.getValue().toLowerCase())){if(k.getListItem(s).isSelected()){this.setValue("")}else{this.setSelection(i)}}}else{this._bPreventValueRemove=true}if(e){this.close()}};K.prototype.onsapenter=function(t){var i=this.getAggregation("tokenizer");e.prototype.onsapenter.apply(this,arguments);this._showAlreadySelectedVisualEffect();if(this.getValue()){this._selectItemByKey(t)}if(!this.getEditable()&&i.getHiddenTokensCount()&&t.target===this.getFocusDomRef()){i._togglePopup(i.getTokensPopup())}};K.prototype.onsaptabnext=function(e){var t=this.getValue();if(t){var i=this._getUnselectedItemsStartingText(t);if(i.length===1){this._selectItemByKey(e)}else{this._showWrongValueVisualEffect()}}};K.prototype.onsaptabprevious=K.prototype.onsaptabnext;K.prototype.onsapfocusleave=function(e){var t=this.isPlatformTablet(),i=x.byId(e.relatedControlId),s=i&&i.getFocusDomRef(),n=this.getValue(),o=this.getPicker(),r=this.getAggregation("tokenizer");if(!this._bPickerIsOpening&&(!o||!o.getFocusDomRef()||!s||!R.contains(o.getFocusDomRef(),s))){this.setValue(null);if(n){this.fireChangeEvent("",{value:n})}if(!R.contains(this.getDomRef(),document.activeElement)){r.setRenderMode(w.Narrow)}}if(o&&s){if(O(o.getFocusDomRef(),s)&&!t&&!this.isPickerDialog()){this.focus()}}};K.prototype.onfocusin=function(e){var t=this.getPicker();var i=false;var s=t&&t.getFocusDomRef();var n=t&&t.oPopup.getOpenState()||M.CLOSED;var o=n===M.CLOSING||n===M.CLOSED;var r=this.getPickerType()==="Dropdown";var a=this.getAggregation("tokenizer");if(r){i=s&&R.contains(s,e.relatedTarget)}if(this.getEditable()&&e.target===this.getDomRef("inner")){a.setRenderMode(w.Loose)}if(e.target===this.getFocusDomRef()){a.hasOneTruncatedToken()&&a.setFirstTokenTruncated(false);this.getEnabled()&&this.addStyleClass("sapMFocus");!o&&i&&this.handleInputValidation(e,false)}if(e.target===this.getOpenArea()&&r&&!this.isPlatformTablet()){this.focus()}if(!this.isOpen()&&this.shouldValueStateMessageBeOpened()){this.openValueStateMessage()}};K.prototype._handleItemTap=function(e){var t=R(e.target).control(0);if(!t.isA("sap.m.CheckBox")&&!t.isA("sap.m.GroupHeaderListItem")){this._bCheckBoxClicked=false}};K.prototype._handleItemPress=function(e){if(this.isOpen()&&this._isListInSuggestMode()&&this.getPicker().oPopup.getOpenState()!==M.CLOSING){this.clearFilter();var t=this._getLastSelectedItem();if(t){k.getListItem(t).focus()}}};K.prototype._handleSelectionLiveChange=function(e){if(e.getParameter("selectAll")){return}var t=e.getParameter("listItem");var i=e.getParameter("listItems");var s=i&&i[i.length-1]||t;var n=this.isPickerDialog()?this.getPickerTextField():this;var o=this._getIsClick()&&!!s;var r=e.getParameter("selected");var a=k.getItemByListItem(this.getItems(),t);var l;if(i&&i.length){l=[];i.forEach(function(e){if(e.getType()==="Active"){l.push(k.getItemByListItem(this.getItems(),e))}},this)}if(t.getType()==="Inactive"){return}D(a,"The corresponding mapped item was not found on "+this);if(!a){return}var h={item:a,items:l,id:a.getId(),key:a.getKey(),selectAll:false,fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:true};if(r){this.fireChangeEvent(a.getText());this.setSelection(h)}else{this.fireChangeEvent(a.getText());this.removeSelection(h)}if(this._bCheckBoxClicked){n.setValue(this._sOldInput);if(o&&this.isOpen()&&this.getPicker().oPopup.getOpenState()!==M.CLOSING){s.focus();this._setIsClick(false)}}else{this._bCheckBoxClicked=true;this.setValue("");this.close()}};K.prototype.onkeydown=function(e){var t=this.getEditable(),s=this.getAggregation("tokenizer"),n=s.getTokens().length;i.prototype.onkeydown.apply(this,arguments);if(!this.getEnabled()){return}if((e.ctrlKey||e.metaKey)&&e.which===A.I&&n){e.preventDefault();if(t){this._togglePopover()}else{this._handleIndicatorPress()}return}this._bIsPasteEvent=(e.ctrlKey||e.metaKey)&&e.which===A.V;if(this.getValue().length===0&&(e.ctrlKey||e.metaKey)&&e.which===A.A&&this._hasTokens()){s.focus();s.selectAllTokens(true);e.preventDefault()}if(this.isPickerDialog()){this._sOldValue=this.getPickerTextField().getValue();this._iOldCursorPos=R(this.getFocusDomRef()).cursorPos()}this._bDoTypeAhead=!p.os.android&&e.which!==A.BACKSPACE&&e.which!==A.DELETE};K.prototype.oninput=function(e){i.prototype.oninput.apply(this,arguments);var t=e.srcControl,s=this.isPickerDialog(),n=s?this.getPickerTextField():this,o=n.getValueState();if(o===z.Error&&this._bAlreadySelected){n.setValueState(this._sInitialValueState);n.setValueStateText(this._sInitialValueStateText);this._bAlreadySelected=false}if(!this.getEnabled()||!this.getEditable()){return}this.syncPickerContent();this.handleInputValidation(e,this.isComposingCharacter());if(this._bIsPasteEvent){t.updateDomValue(this._sOldValue||e.target.value||"");return}if(this.isOpen()){setTimeout(this.highlightList.bind(this,this._sOldInput))}if(this._getItemsShownWithFilter()){this.toggleIconPressedStyle(true)}};K.prototype.filterItems=function(e){return T(this,e.items,e.value,true,false,this.fnFilter||_)};K.prototype.onkeyup=function(e){if(!this.getEnabled()||!this.getEditable()){return}this._sOldValue=this.getValue();this._iOldCursorPos=R(this.getFocusDomRef()).cursorPos()};K.prototype._showWrongValueVisualEffect=function(){var e=this._getSuggestionsPopover();var t=this._sInitialValueStateText;var i=this._sInitialValueState;var s=t||this._oRbC.getText("VALUE_STATE_ERROR");var n=this;if(i===z.Error){return}if(e){e.updateValueState(z.Error,s,true);setTimeout(e.updateValueState.bind(e,n.getValueState(),s,true),1e3)}if(!this.isPickerDialog()){this.setValueState(z.Error);this.setValueStateText(this.getValueStateText()||s);setTimeout(this["setValueState"].bind(this,i||z.Error),1e3)}this._syncInputWidth(this.getAggregation("tokenizer"))};K.prototype._showAlreadySelectedVisualEffect=function(){var e=this._oRbM.getText("VALUE_STATE_ERROR_ALREADY_SELECTED");if(!this.getValue()){return}var t=!!this.getSelectedItems().filter(function(e){return e.getText().toLowerCase()===this.getValue().toLowerCase()},this).length;var i=this.getItems().filter(function(e){return e.getText().toLowerCase()===this.getValue().toLowerCase()},this).length;if(t){this._sInitialValueState=this.getValueState();this._sInitialValueStateText=this.getValueStateText();this.setValueStateText(e);this._bAlreadySelected=true;this.setValueState("Error");return}else if(i){return}else{this._showWrongValueVisualEffect()}};K.prototype._hasShowSelectedButton=function(){return true};K.prototype.forwardEventHandlersToSuggPopover=function(e){i.prototype.forwardEventHandlersToSuggPopover.apply(this,arguments);e.setShowSelectedPressHandler(this._filterSelectedItems.bind(this))};K.prototype.configPicker=function(e){var t=this.getRenderer(),i=t.CSS_CLASS_MULTICOMBOBOX;e.setHorizontalScrolling(false).addStyleClass(t.CSS_CLASS_COMBOBOXBASE+"Picker").addStyleClass(i+"Picker").addStyleClass(i+"Picker-CTX").attachBeforeOpen(this.onBeforeOpen,this).attachAfterOpen(this.onAfterOpen,this).attachBeforeClose(this.onBeforeClose,this).attachAfterClose(this.onAfterClose,this).addEventDelegate({onBeforeRendering:this.onBeforeRenderingPicker,onAfterRendering:this.onAfterRenderingPicker},this)};K.prototype._configureList=function(e){var t=10;if(!e){return}e.setMode(B.MultiSelect);e.setIncludeItemInSelection(true);e.setGrowingThreshold(t);e.attachBrowserEvent("tap",this._handleItemTap,this).attachSelectionChange(this._handleSelectionLiveChange,this).attachItemPress(this._handleItemPress,this);e.addEventDelegate({onAfterRendering:this.onAfterRenderingList,onfocusin:this.onFocusinList},this)};K.prototype._decoratePopupInput=function(e){i.prototype._decoratePopupInput.apply(this,arguments);if(!e||!e.isA(["sap.m.InputBase"])){return}e.attachSubmit(function(t){var i=e.getValue();if(i){this.setValue(i);this._selectItemByKey();this.setValue(this._sOldInput);this.close()}}.bind(this));e.addEventDelegate({onfocusout:this._handleInputFocusOut},this);return e};K.prototype.onBeforeRendering=function(){var e=this.getEditable();var t=this.getAggregation("tokenizer");i.prototype.onBeforeRendering.apply(this,arguments);this._bInitialSelectedKeysSettersCompleted=true;t.setEnabled(this.getEnabled());t.setEditable(e);this._updatePopoverBasedOnEditMode(e);if(!this.getItems().length){this._clearTokenizer()}if(this._getList()){this.syncPickerContent(true)}this._deregisterResizeHandler();this._synchronizeSelectedItemAndKey();this.setProperty("hasSelection",!!this.getSelectedItems().length,true);if(!this._bAlreadySelected){this._sInitialValueStateText=this.getValueStateText()}if(this.getValueState()!==z.Error){this._sInitialValueState=this.getValueState()}};K.prototype.syncPickerContent=function(e){var t,i,s=this.getPicker();if(!s){s=this.createPicker(this.getPickerType());this._updateSuggestionsPopoverValueState();e=true}if(e){i=this._getList();t=this.getEditable()?this.getItems():this.getSelectedItems();this._synchronizeSelectedItemAndKey();i.destroyItems();this._clearTokenizer();this._fillList(t);if(i.getItemNavigation()){this._iFocusedIndex=i.getItemNavigation().getFocusedIndex()}}return s};K.prototype._registerResizeHandler=function(){D(!this._iResizeHandlerId,"Resize handler already registered");this._iResizeHandlerId=m.register(this,this._onResize.bind(this))};K.prototype._deregisterResizeHandler=function(){if(this._iResizeHandlerId){m.deregister(this._iResizeHandlerId);this._iResizeHandlerId=null}};K.prototype._onResize=function(){var e=this.getAggregation("tokenizer");e.setMaxWidth(this._calculateSpaceForTokenizer());this._syncInputWidth(e);this._handleNMoreAccessibility()};K.prototype.onBeforeRenderingPicker=function(){var e=this["_onBeforeRendering"+this.getPickerType()];if(e){e.call(this)}};K.prototype.onAfterRenderingPicker=function(){var e=this["_onAfterRendering"+this.getPickerType()];if(e){e.call(this)}};K.prototype.onBeforeOpen=function(){i.prototype.onBeforeOpen.apply(this,arguments);var e=this["_onBeforeOpen"+this.getPickerType()];this.addContent();this._aInitiallySelectedItems=this.getSelectedItems();this._synchronizeSelectedItemAndKey();if(e){e.call(this)}};K.prototype.onAfterOpen=function(){var e=this.getFocusDomRef(),t=this.getValueStateLinks();e&&this.getFocusDomRef().setAttribute("aria-expanded","true");this._bPickerIsOpening=false;if(!this.isPlatformTablet()){this.getPicker().setInitialFocus(this)}t.forEach(function(e){e.addDelegate({onAfterRendering:function(){if(this.getFocusDomRef()){this.getFocusDomRef().setAttribute("tabindex","-1")}}},e)});this.closeValueStateMessage()};K.prototype.onBeforeClose=function(){i.prototype.onBeforeClose.apply(this,arguments)};K.prototype.onAfterClose=function(){var e=!R.contains(this.getDomRef(),document.activeElement)||this.isPickerDialog(),t=this.getFocusDomRef();t&&this.getFocusDomRef().setAttribute("aria-expanded","false");this.toggleIconPressedStyle(false);this.clearFilter();!this.isComposingCharacter()&&!this._bPreventValueRemove&&this.setValue("");this._sOldValue="";this._sOldInput="";this._getSuggestionsPopover()._sTypedInValue="";if(this.isPickerDialog()){this.getPickerTextField().setValue("");this.getFilterSelectedButton()&&this.getFilterSelectedButton().setPressed(false)}this.fireSelectionFinish({selectedItems:this.getSelectedItems()});this.getAggregation("tokenizer").setRenderMode(e?w.Narrow:w.Loose);if(this.getValueState()==z.Error&&document.activeElement===this.getFocusDomRef()){this.selectText(0,this.getValue().length)}};K.prototype._onBeforeOpenDialog=function(){};K.prototype._onBeforeOpenDropdown=function(){var e=this.getPicker(),t=this.getDomRef(),i;if(t&&e){i=t.offsetWidth/parseFloat(h.BaseFontSize)+"rem";e.setContentMinWidth(i)}};K.prototype.getFilterSelectedButton=function(){return this._getSuggestionsPopover().getFilterSelectedButton()};K.prototype._filterSelectedItems=function(e,t){var i=e.oSource,s,n,o=this.getPickerTextField()?this.getPickerTextField().getValue():"",r=i&&i.getPressed&&i.getPressed()||t,a=k.getVisibleItems(this.getItems()),l=this.getItems(),h=this.getSelectedItems(),u=null;if(r){a.forEach(function(e){n=h.indexOf(e)>-1?true:false;s=k.getListItem(e);if(!s){return}if(s.isA("sap.m.GroupHeaderListItem")){s.setVisible(false);u=s}else{s.setVisible(n);if(n&&u){u.setVisible(true)}}},this)}else{b(this.getItems(),this.filterItems({value:o,items:l}))}};K.prototype.revertSelection=function(){this.setSelectedItems(this._aInitiallySelectedItems)};K.prototype.setSelection=function(e){var t=this._getList(),i;if(e.item&&this.isItemSelected(e.item)){return}if(!e.item){return}if(!e.items||!e.items.length||e.selectAll){i=[e.item]}else{i=e.items}i.forEach(function(i){if(!e.listItemUpdated&&k.getListItem(i)&&t){t.setSelectedItem(k.getListItem(i),true)}var s=new n({key:i.getKey()});s.setText(i.getText());i.data(k.CSS_CLASS+"Token",s);this.getAggregation("tokenizer").addToken(s);this.addAssociation("selectedItems",i,e.suppressInvalidate);var o=this.getSelectedKeys();var r=this.getKeys([i])[0];if(r===""||o.indexOf(r)===-1){o.push(r);this.setProperty("selectedKeys",o,e.suppressInvalidate)}if(e.fireChangeEvent){this.fireSelectionChange({changedItem:e.item,changedItems:e.items,selectAll:e.selectAll,selected:true})}},this);this.setValue("");if(e.fireFinishEvent){if(!this.isOpen()){this.fireSelectionFinish({selectedItems:this.getSelectedItems()})}}};K.prototype.removeSelection=function(e){var t,i,s;if(e.item&&!this.isItemSelected(e.item)){return}if(!e.item){return}if(!e.items||!e.items.length||e.selectAll){t=[e.item]}else{t=e.items}t.forEach(function(t){this.removeAssociation("selectedItems",t,e.suppressInvalidate);i=this.getSelectedKeys();s=i.indexOf(t.getKey());i.splice(s,1);this.setProperty("selectedKeys",i,e.suppressInvalidate);if(!e.listItemUpdated&&k.getListItem(t)){var n=k.getListItem(t);this._getList().setSelectedItem(n,false)}if(!e.tokenUpdated){var o=V(t);t.data(k.CSS_CLASS+"Token",null);this.getAggregation("tokenizer").removeToken(o)}if(e.fireChangeEvent){this.fireSelectionChange({changedItem:e.item,changedItems:e.items,selectAll:e.selectAll,selected:false})}},this);if(e.fireFinishEvent){if(!this.isOpen()){this.fireSelectionFinish({selectedItems:this.getSelectedItems()})}}};K.prototype._synchronizeSelectedItemAndKey=function(){var e=this.getSelectedKeys();var t=this.getKeys(this.getSelectedItems());if(!e.length){L.info("Info: _synchronizeSelectedItemAndKey() the MultiComboBox control does not contain any item on ",this);return}for(var i=0,s=null,n=null,o=e.length;i<o;i++){s=e[i];if(t.indexOf(s)>-1){continue}n=this.getItemByKey(""+s);if(n){this.setSelection({item:n,id:n.getId(),key:n.getKey(),fireChangeEvent:false,suppressInvalidate:true,listItemUpdated:false})}}};K.prototype.updateItems=function(e){var t=function(e){return e&&e.getKey&&e.getKey()},s,n=this.getSelectedItems().map(t),o=this.getSelectedKeys();var r=i.prototype.updateItems.apply(this,arguments);n=this.getSelectedItems().map(t).filter(function(e){return n.indexOf(e)>-1});s=o.concat(n);this.setSelectedKeys(s);return r};K.prototype._getSelectedItemsOf=function(e){for(var t=0,i=e.length,s=[];t<i;t++){if(k.getListItem(e[t]).isSelected()){s.push(e[t])}}return s};K.prototype._getLastSelectedItem=function(){var e=this.getAggregation("tokenizer").getTokens();var t=e.length?e[e.length-1]:null;if(!t){return null}return this._getItemByToken(t)};K.prototype._getFocusedListItem=function(){if(!document.activeElement){return null}var e=x.byId(document.activeElement.id);if(this._getList()&&y(this._getList().getFocusDomRef(),e.getFocusDomRef())){return e}return null};K.prototype._getFocusedItem=function(){return k.getItemByListItem(this.getItems(),this._getFocusedListItem())};K.prototype._hasTokens=function(){return this.getAggregation("tokenizer").getTokens().length>0};K.prototype._decorateListItem=function(e){e.addDelegate({onkeydown:function(e){if((e.ctrlKey||e.metaKey)&&e.which==A.A){e.setMarked();e.preventDefault();var t=k.getSelectableItems(this.getItems()).filter(function(e){return!e.isA("sap.ui.core.SeparatorItem")&&!e.isA("sap.m.GroupHeaderListItem")});var i=this._getSelectedItemsOf(t);if(i.length!==t.length){t.forEach(function(e){this.setSelection({item:e,items:t,selectAll:true,id:e.getId(),key:e.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false})},this)}else{t.forEach(function(e){this.removeSelection({item:e,items:t,selectAll:true,id:e.getId(),key:e.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false})},this)}}},onmousedown:function(e){this._setIsClick(true)},onkeyup:function(e){var t=null;if(e.which==A.SPACE&&this.isOpen()&&this._isListInSuggestMode()){this.open();t=this._getLastSelectedItem();if(t){k.getListItem(t).focus()}return}}},true,this);e.addEventDelegate({onsapbackspace:function(e){e.preventDefault()},onsapshow:function(e){e.setMarked();if(this.isOpen()){this.close();return}if(this.hasContent()){this.open()}},onsaphide:function(e){this.onsapshow(e)},onsapenter:function(e){e.setMarked();this.close()},onsaphome:function(e){e.setMarked();e.preventDefault();if(this.getValueState()!==z.None){this._handleFormattedTextNav();e.stopPropagation(true);return}var t=k.getSelectableItems(this.getItems());var i=t[0];k.getListItem(i).focus()},onsapend:function(e){e.setMarked();e.preventDefault();var t=k.getSelectableItems(this.getItems());var i=t[t.length-1];k.getListItem(i).focus()},onsapup:function(e){e.setMarked();e.preventDefault();var t=k.getVisibleItems(this.getItems());var i=t[0];var s=R(document.activeElement).control()[0];if(s===k.getListItem(i)&&this.getValueState()!==z.None){this._handleFormattedTextNav();e.stopPropagation(true);return}else if(s===k.getListItem(i)){this.focus();e.stopPropagation(true)}},onfocusin:function(e){this.addStyleClass(this.getRenderer().CSS_CLASS_MULTICOMBOBOX+"Focused")},onfocusout:function(e){this.removeStyleClass(this.getRenderer().CSS_CLASS_MULTICOMBOBOX+"Focused")},onsapfocusleave:function(e){var t=this.getAggregation("picker");var i=x.byId(e.relatedControlId);if(t&&i&&O(t.getFocusDomRef(),i.getFocusDomRef())){if(e.srcControl){e.srcControl.focus()}}},onsaptabnext:function(){this.getPicker().close()},onsaptabprevious:function(){this.getPicker().close()}},this);if(p.support.touch){e.addEventDelegate({ontouchstart:function(e){e.setMark("cancelAutoClose")}})}};K.prototype._handleInputFocusOut=function(){var e=this.isPickerDialog()?this.getPickerTextField():this,t=this._sOldInput||this._sOldValue||"";e.updateDomValue(t);this._bIsPasteEvent=null};K.prototype.onItemChange=function(e){var t=i.prototype.onItemChange.call(this,e,this.getShowSecondaryValues());var s=e.getParameters();P({item:e.getSource(),propName:s.name,propValue:s.newValue});return t};K.prototype._handleIndicatorPress=function(){var e,t=this.getAggregation("tokenizer");if(this.getEditable()){this.syncPickerContent();this._filterSelectedItems({},true);this.focus();e=this.getPicker();e.open()}else{t._togglePopup(t.getTokensPopup())}if(this.isPickerDialog()){this.getFilterSelectedButton().setPressed(true);this.bOpenedByKeyboardOrButton=true}};K.prototype._togglePopover=function(){var e=this.getPicker();if(!e){e=this.syncPickerContent(true)}if(e.isOpen()){e.close()}else{e.open()}};K.prototype._createTokenizer=function(){var e=new s({renderMode:w.Narrow}).attachTokenDelete(this._handleTokenDelete,this);e.getTokensPopup().attachAfterOpen(function(){if(e.hasOneTruncatedToken()){e.setFirstTokenTruncated(false)}}).attachAfterClose(function(){var t=e.getTokens();if(t.length===1&&!t[0].getTruncated()){e.setFirstTokenTruncated(true)}});e.addEventDelegate({onAfterRendering:this._onAfterRenderingTokenizer},this);return e};K.prototype._onAfterRenderingTokenizer=function(){var e=this.getAggregation("tokenizer");if(this.getEditable()){e.addStyleClass("sapMTokenizerIndicatorDisabled")}else{e.removeStyleClass("sapMTokenizerIndicatorDisabled")}setTimeout(this._syncInputWidth.bind(this,e),0);setTimeout(this._handleNMoreAccessibility.bind(this),0);setTimeout(e["scrollToEnd"].bind(e),0);this._toggleTokenClass()};K.prototype._handleTokenDelete=function(e){var t=e.getParameter("tokens");var i=this.getSelectedItems();this._removeSelection(t);if(i.length!==k.getSelectableItems(this.getItems())){!this.isPickerDialog()&&!this.isFocusInTokenizer()&&this.focus();this.fireChangeEvent("");this.setProperty("hasSelection",!!this.getSelectedItems().length)}};K.prototype._removeSelection=function(e){var t=this.getAggregation("tokenizer");e.forEach(function(e){var i=e&&this._getItemByToken(e);if(!this.getEditable()||!this.getEnabled()||!i||!this.isItemSelected(i)||!i.getEnabled()||!e.getEditable()){return}this.removeSelection({item:i,id:i.getId(),key:i.getKey(),tokenUpdated:true,fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true});e.destroy();if(this.getSelectedItems().length>0){var s=t.getTokens();s[s.length-1].focus()}else{this.focus()}},this)};K.prototype.onAfterRenderingList=function(){var e=this._getList();var t=document.activeElement===this.getFocusDomRef();if(this.getEditable()&&!t&&e&&e.getItems()[this._iFocusedIndex]){e.getItems()[this._iFocusedIndex].focus();this._iFocusedIndex=null}};K.prototype.onFocusinList=function(){if(this._bListItemNavigationInvalidated&&this._getList().getItemNavigation()){this._getList().getItemNavigation().setSelectedIndex(this._iInitialItemFocus);this._bListItemNavigationInvalidated=false}};K.prototype.onAfterRendering=function(){var e=this.getAggregation("tokenizer");i.prototype.onAfterRendering.apply(this,arguments);this._registerResizeHandler();setTimeout(function(){e.setMaxWidth(this._calculateSpaceForTokenizer())}.bind(this),0)};K.prototype.onfocusout=function(e){this.isOpen()&&this._handleInputFocusOut();this.removeStyleClass("sapMFocus");if(this.getValueState()===z.Error&&this.getValueStateText()===this._oRbM.getText("VALUE_STATE_ERROR_ALREADY_SELECTED")){this.setValueState(this._sInitialValueState);this.setValueStateText(this._sInitialValueStateText)}i.prototype.onfocusout.apply(this,arguments)};K.prototype.onpaste=function(e){var t;var i=false;var s=this.getSelectedItems();if(window.clipboardData){t=window.clipboardData.getData("Text")}else{t=e.originalEvent.clipboardData.getData("text/plain")}var n=t.split(/\r\n|\r|\n/g);if(n&&n.length>0){k.getSelectableItems(this.getItems()).filter(function(e){return s.indexOf(e)===-1}).forEach(function(e){if(n.indexOf(e.getText())>-1){i=true;this.setSelection({item:e,id:e.getId(),key:e.getKey(),fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true,listItemUpdated:false})}},this)}if(i){e.stopPropagation();e.preventDefault()}};K.prototype.onsapbackspace=function(e){var t=this.getAggregation("tokenizer");var i=t.getTokens();var s=i.filter(function(e){return e.getSelected()});if(!this.getEnabled()||!this.getEditable()){e.preventDefault();return}if(this.getCursorPosition()>0||this.getValue().length>0){return}if(s.length>0){this._removeAllTokens();return}if(document.activeElement===this.getFocusDomRef()){i[i.length-1]&&i[i.length-1].focus()}e.preventDefault()};K.prototype._removeAllTokens=function(){var e=this.getAggregation("tokenizer");var t=e.getTokens().filter(function(e){return e.getSelected()});if(!t.length){return}this._removeSelection(t);this.fireChangeEvent("");this.invalidate()};K.prototype.onsapdelete=K.prototype.onsapbackspace;K.prototype.onsapnext=function(e){var t=this.getAggregation("tokenizer");if(e.isMarked()){return}var i=R(document.activeElement).control()[0];if(!i){return}if(i===t||t.$().find(i.$()).length>0&&this.getEditable()){t.scrollToEnd();this.focus()}};K.prototype.onsapprevious=function(e){if(this.getCursorPosition()===0&&!v(this.getFocusDomRef())){if(e.srcControl===this){s.prototype.onsapprevious.apply(this.getAggregation("tokenizer"),arguments)}}};K.prototype.onclick=function(e){var t=this.getEditable(),i=this.getEnabled(),s=e.target.className.indexOf("sapMTokenizerIndicator")>-1;if(t&&i&&s){e.preventDefault();this._handleIndicatorPress()}};K.prototype.ontap=function(e){i.prototype.ontap.apply(this,arguments);var t=this.getOpenArea();if(!this.getEnabled()||!this.getEditable()){return}e.setMarked();if(this.isPickerDialog()&&t.contains(e.target)){this.open()}};K.prototype.getOpenArea=function(){if(this.isPickerDialog()){return this.getDomRef()}else{return i.prototype.getOpenArea.apply(this,arguments)}};K.prototype._getItemsStartingWithPerTerm=function(e,t){var i=[],s=t?k.getEnabledItems(this.getItems()):k.getSelectableItems(this.getItems()),n=this.fnFilter?this.fnFilter:_;s.forEach(function(t){if(n(e,t)){i.push(t)}},this);return i};K.prototype._getItemsStartingWith=function(e,t){var i=[],s=t?k.getEnabledItems(this.getItems()):k.getSelectableItems(this.getItems());s.forEach(function(t){if(typeof e==="string"&&e!==""&&t.getText().toLowerCase().startsWith(e.toLowerCase())){i.push(t)}},this);return i};K.prototype._getUnselectedItemsStartingText=function(e){var t=[];this._getUnselectedItems().forEach(function(i){if(typeof e==="string"&&e!==""&&i.getText().toLowerCase().startsWith(e.toLowerCase())){t.push(i)}},this);return t};K.prototype.getCursorPosition=function(){return this._$input.cursorPos()};K.prototype._selectPreviousItemsOf=function(e){var t;do{t=true;var i=this._getPreviousVisibleItemOf(e);if(i){var s=k.getListItem(i);if(s){t=k.getListItem(i).getSelected()}}this.setSelection({item:e,id:e.getId(),key:e.getKey(),fireChangeEvent:true,suppressInvalidate:true});e=i}while(!t)};K.prototype._getNextVisibleItemOf=function(e){var t=k.getSelectableItems(this.getItems());var i=t.indexOf(e)+1;if(i<=0||i>t.length-1){return null}return t[i]};K.prototype._getPreviousVisibleItemOf=function(e){var t=k.getSelectableItems(this.getItems());var i=t.indexOf(e)-1;if(i<0){return null}return t[i]};K.prototype._getNextUnselectedItemOf=function(e){var t=this._getUnselectedItems();var i=t.indexOf(e)+1;if(i<=0||i>t.length-1){return null}return t[i]};K.prototype._getPreviousUnselectedItemOf=function(e){var t=this._getUnselectedItems();var i=t.indexOf(e)-1;if(i<0){return null}return t[i]};K.prototype._getNextTraversalItem=function(){var e=this.getValue();var t=e?this._getItemsStartingWithPerTerm(e):[];var i=this._getUnselectedItems();if(t.indexOf(this._oTraversalItem)>-1&&this._oTraversalItem.getText()===this.getValue()){return this._getNextUnselectedItemOf(this._oTraversalItem)}if(t.length&&t[0].getText()===this.getValue()){return this._getNextUnselectedItemOf(t[0])}return t.length?t[0]:i[0]};K.prototype._getPreviousTraversalItem=function(){var e=this.getValue();var t=e?this._getItemsStartingWithPerTerm(e):[];if(t.indexOf(this._oTraversalItem)>-1&&this._oTraversalItem.getText()===this.getValue()){return this._getPreviousUnselectedItemOf(this._oTraversalItem)}if(t.length&&t[t.length-1].getText()===this.getValue()){return this._getPreviousUnselectedItemOf(t[t.length-1])}if(t.length){return t[t.length-1]}else{var i=this._getUnselectedItems();if(i.length>0){return i[i.length-1]}else{return null}}};K.prototype.setSelectedItems=function(e){this.removeAllSelectedItems();if(!e||!e.length){return this}if(!Array.isArray(e)){L.warning("Warning: setSelectedItems() has to be an array of sap.ui.core.Item instances or of valid sap.ui.core.Item IDs",this);return this}e.forEach(function(e){if(!(e instanceof d)&&typeof e!=="string"){L.warning("Warning: setSelectedItems() has to be an array of sap.ui.core.Item instances or of valid sap.ui.core.Item IDs",this);return}if(typeof e==="string"){e=x.byId(e)}this.setSelection({item:e?e:null,id:e?e.getId():"",key:e?e.getKey():"",suppressInvalidate:true})},this);return this};K.prototype.addSelectedItem=function(e){if(!e){return this}if(typeof e==="string"){e=x.byId(e)}this.setSelection({item:e?e:null,id:e?e.getId():"",key:e?e.getKey():"",fireChangeEvent:false,suppressInvalidate:true});return this};K.prototype.removeSelectedItem=function(e){if(!e){return null}if(typeof e==="string"){e=x.byId(e)}if(!this.isItemSelected(e)){return null}this.removeSelection({item:e,id:e.getId(),key:e.getKey(),fireChangeEvent:false,suppressInvalidate:true});return e};K.prototype.removeAllSelectedItems=function(){var e=[];var t=this.getAssociation("selectedItems",[]);t.forEach(function(t){var i=this.removeSelectedItem(t);if(i){e.push(i.getId())}},this);return e};K.prototype.removeSelectedKeys=function(e){var t,i=[];if(!e||!e.length||!Array.isArray(e)){return i}e.forEach(function(e){t=this.getItemByKey(e);if(t){this.removeSelection({item:t?t:null,id:t?t.getId():"",key:t?t.getKey():"",fireChangeEvent:false,suppressInvalidate:true});i.push(t)}},this);return i};K.prototype.setSelectedKeys=function(e){if(this._bInitialSelectedKeysSettersCompleted){this.setProperty("selectedKeys",[],true);this.removeAllSelectedItems()}this.addSelectedKeys(e);this._bInitialSelectedKeysSettersCompleted=true;return this};K.prototype.addSelectedKeys=function(e){var t,i=[];e=this.validateProperty("selectedKeys",e);e.forEach(function(e){var t=this.getItemByKey(e);if(t){this.addSelectedItem(t)}else if(e!=null){i.push(e)}},this);if(i.length>0){t=this.getProperty("selectedKeys").filter(function(e){return i.indexOf(e)===-1});i=t.concat(i);this.setProperty("selectedKeys",i,true)}return this};K.prototype._getUnselectedItems=function(){var e=R(k.getSelectableItems(this.getItems())).not(this.getSelectedItems()).get();if(!this.isOpen()){return e.filter(function(e){return!e.isA("sap.ui.core.SeparatorItem")})}return e};K.prototype.getSelectedItems=function(){var e=[],t=this.getAssociation("selectedItems")||[];t.forEach(function(t){var i=x.byId(t);if(i){e.push(i)}},this);return e};K.prototype.getWidth=function(){return this.getProperty("width")||"100%"};K.prototype._updatePopoverBasedOnEditMode=function(e){var t=this._getList(),i=this._getSuggestionsPopover();if(!t){return}if(e){i.addContent(t)}};K.prototype._mapItemToListItem=function(e){var t,i,s,o=this.getRenderer();if(!e){return null}t=k.createListItemFromCoreItem(e,this.getShowSecondaryValues());this._decorateListItem(t);if(e.isA("sap.ui.core.SeparatorItem")){return t}i=o.CSS_CLASS_MULTICOMBOBOX+"Item";s=this.isItemSelected(e)?i+"Selected":"";t.addStyleClass(i+" "+s);if(s){var r=new n({key:e.getKey()});r.setText(e.getText());e.data(k.CSS_CLASS+"Token",r);this.getAggregation("tokenizer").addToken(r,true)}this.setSelectable(e,e.getEnabled());return t};K.prototype.setSelectable=function(e,t){i.prototype.setSelectable.call(this,e,t);var s=V(e);if(s){s.setVisible(t)}};K.prototype._fillList=function(){var e=this._getList();var t=this.getEditable()?this.getItems():this.getSelectedItems();if(!e){return}e.destroyItems();if(!this._oListItemEnterEventDelegate){this._oListItemEnterEventDelegate={onsapenter:function(e){if(e.srcControl.isSelected()){e.setMarked()}}}}for(var i=0,s,n=t.length;i<n;i++){s=this._mapItemToListItem(t[i]);s.addDelegate(this._oListItemEnterEventDelegate,true,this,true);this._getList().addAggregation("items",s,true);if(this.isItemSelected(t[i])){this._getList().setSelectedItem(s,true)}}};K.prototype.handleInputValidation=function(e,t){var i=e.target.value,s=this.isValueValid(i),n,o,r;var a=e.srcControl;if(!s&&i!==""&&!t){this._handleFieldValidationState(a);return}r=this._getItemsStartingWith(i,true);if(!t||this._bIsPasteEvent){this._handleTypeAhead(i,r,a)}n=this.getItems();if(this.isPickerDialog()){o=this.getFilterSelectedButton();if(o!=null&&o.getPressed()){o.setPressed(false)}}b(this.getItems(),this.filterItems({value:i,items:n}));this._sOldInput=i;if((!this.getValue()||!s)&&!this.bOpenedByKeyboardOrButton&&!this.isPickerDialog()){this.close()}else{this.open()}};K.prototype.isValueValid=function(e){var t=this._getItemsStartingWith(e,true);var i=this._getItemsStartingWithPerTerm(e,true);return t.length||i.length};K.prototype._handleTypeAhead=function(e,t,i){var s,n;if(!this._bDoTypeAhead){return}s=this.getSelectedItems();n=t.filter(function(e){return s.indexOf(e)===-1});S(e,i,n)};K.prototype._handleFieldValidationState=function(e){if(this._sOldInput&&this.isValueValid(this._sOldInput)){e.updateDomValue(this._sOldInput)}else if(this._sOldValue&&this.isValueValid(this._sOldValue)){e.updateDomValue(this._sOldValue)}else{e.updateDomValue("")}if(this._iOldCursorPos){R(e.getFocusDomRef()).cursorPos(this._iOldCursorPos)}this._showWrongValueVisualEffect()};K.prototype.init=function(){this._oRb=x.getLibraryResourceBundle("sap.m");i.prototype.init.apply(this,arguments);this._bInitialSelectedKeysSettersCompleted=false;this._bListItemNavigationInvalidated=false;this._iInitialItemFocus=-1;this._bCheckBoxClicked=true;this._bPreventValueRemove=false;this._oTokenizer=this._createTokenizer();this.setAggregation("tokenizer",this._oTokenizer);this._aInitiallySelectedItems=[];this._oRbM=x.getLibraryResourceBundle("sap.m");this._oRbC=x.getLibraryResourceBundle("sap.ui.core");this._fillList()};K.prototype.handleItemRemoval=function(e){this.removeSelection({item:e,id:e?e.getId():"",key:e?e.getKey():"",fireChangeEvent:false,suppressInvalidate:true,listItemUpdated:true})};K.prototype.isItemSelected=function(e){return this.getSelectedItems().indexOf(e)>-1};K.prototype._clearTokenizer=function(){this.getAggregation("tokenizer").destroyTokens()};K.prototype._toggleTokenClass=function(){this.toggleStyleClass("sapMMultiComboBoxHasToken",this._hasTokens())};K.prototype.exit=function(){i.prototype.exit.apply(this,arguments);this._deregisterResizeHandler();if(this._oTokenizer){this._oTokenizer.destroy();this._oTokenizer=null}this._oRbC=null;this._oRbM=null;this._oListItemEnterEventDelegate=null;this._sInitialValueState=null};K.prototype.destroyItems=function(){this.setProperty("selectedKeys",[]);this._clearTokenizer();return this.destroyAggregation("items")};K.prototype._getItemByToken=function(e){return k.getItemBy(this.getItems(),e,"Token")};K.prototype._getItemByValue=function(e){var t=k.getSelectableItems(this.getItems());for(var i=0;i<t.length;i++){if(t[i].getText().toLowerCase()===e.toLowerCase()){return t[i]}}};K.prototype._handleItemToFocus=function(){if(this.isOpen()){return}this.syncPickerContent();var e,t,i=x.byId(document.activeElement.id),s=this.getSelectedItems(),n=k.getSelectableItems(this.getItems()),o=this._getList(),r=o&&o.getItemNavigation(),a=this.getValue(),l=this.getPicker();if(i&&i.isA("sap.m.Token")){t=this._getItemByToken(i)}else if(a){t=this._getItemByValue(a)}if(!t){t=s.length?k.getItemByListItem(this.getItems(),this._getList().getSelectedItems()[0]):n[0]}e=k.getVisibleItems(this.getItems()).indexOf(t);if(r){r.setSelectedIndex(e)}else{this._bListItemNavigationInvalidated=true;this._iInitialItemFocus=e}if(!t){l.setInitialFocus(this)}else{l.setInitialFocus(o)}};K.prototype.getAccessibilityInfo=function(){var e=this.getSelectedItems().map(function(e){return e.getText()}).join(" ");var t=i.prototype.getAccessibilityInfo.apply(this,arguments);t.type=x.getLibraryResourceBundle("sap.m").getText("ACC_CTR_TYPE_MULTICOMBO");t.description=((t.description||"")+" "+e).trim();return t};K.prototype._setIsClick=function(e){this._bIsClick=e};K.prototype._getIsClick=function(){return this._bIsClick};K.prototype._calculateSpaceForTokenizer=function(){if(this.getDomRef()){var e,t=this.getDomRef().getBoundingClientRect().width,i=this._calculateIconsSpace(),s=this.$().find(".sapMInputBaseInner"),n=["min-width","padding-right","padding-left"],o=n.reduce(function(e,t){return e+(parseInt(s.css(t))||0)},0);e=t-(i+o);e=e<0?0:e;return e+"px"}else{return null}};K.prototype._syncInputWidth=function(e){var t=this.getDomRef("inner"),i,s;if(!t||e&&!e.getDomRef()){return}s=parseFloat(e.getDomRef().getBoundingClientRect().width.toFixed(2));i=this._calculateIconsSpace();t.style.width="calc(100% - "+parseFloat(i+s)+"px)"};K.prototype._handleNMoreAccessibility=function(){var e=F.getStaticId("sap.m","MULTICOMBOBOX_OPEN_NMORE_POPOVER"),t=this.getAggregation("tokenizer"),i=this.getFocusDomRef(),s=i&&i.getAttribute("aria-describedby"),n=s?s.split(" "):[],o=n.indexOf(e),r=this.getEnabled(),a=!this.getEditable()&&t&&t.getHiddenTokensCount();if(a&&o===-1){n.push(e);r&&this.getFocusDomRef().setAttribute("aria-keyshortcuts","Enter")}else if(o!==-1&&!a){n.splice(o,1);this.getFocusDomRef().removeAttribute("aria-keyshortcuts")}if(i&&n.length){i.setAttribute("aria-describedby",n.join(" ").trim())}};K.prototype.applyShowItemsFilters=function(){this.syncPickerContent();b(this.getItems(),this.filterItems({value:this.getValue()||"_",items:this.getItems()}))};K.prototype.showItems=function(e){var t=true,s=this.fnFilter;if(typeof e==="function"){this.syncPickerContent();this.setFilterFunction(e||function(){return true});t=this.filterItems({value:this.getValue()||"_",items:this.getItems()}).items.length>0;this.setFilterFunction(s)}if(t){i.prototype.showItems.apply(this,arguments)}};return K});