/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/unified/calendar/CalendarUtils","sap/ui/core/date/UniversalDate","sap/ui/unified/CalendarLegendRenderer","sap/ui/unified/library","sap/base/Log"],function(e,t,a,r,i){"use strict";var s=r.CalendarDayType;var n={apiVersion:2};n.render=function(e,t){var a=t._getStartDate();var r=t.getTooltip_AsString();var i=t.getId();var s={value:i+"-Descr",append:true};e.openStart("div",t);e.class("sapUiCalTimesRow");e.class("sapUiCalRow");if(r){e.attr("title",r)}if(t._getShowHeader()){s.value=s.value+" "+i+"-Head"}e.accessibilityState(t,{role:"grid",readonly:"true",multiselectable:!t.getSingleSelection()||t.getIntervalSelection(),labelledby:s});e.openEnd();e.openStart("span",i+"-Descr");e.style("display","none");e.openEnd();e.text(t._rb.getText("CALENDAR_DIALOG"));e.close("span");if(t.getIntervalSelection()){e.openStart("span",i+"-Start");e.style("display","none");e.openEnd();e.text(t._rb.getText("CALENDAR_START_TIME"));e.close("span");e.openStart("span",i+"-End");e.style("display","none");e.openEnd();e.text(t._rb.getText("CALENDAR_END_TIME"));e.close("span")}this.renderRow(e,t,a);e.close("div")};n.renderRow=function(e,t,a){var r=t.getId();this.renderHeader(e,t,a);e.openStart("div",r+"-times");e.class("sapUiCalItems");e.attr("role","row");e.openEnd();this.renderTimes(e,t,a);e.close("div")};n.renderHeader=function(e,t,a){if(t._getShowHeader()){var r=t._getLocaleData();var i=t.getId();e.openStart("div",i+"-Head");e.openEnd();this.renderHeaderLine(e,t,r,a);e.close("div")}};n.renderHeaderLine=function(e,t,a,r){var i=t._getFormatDate();var s=t.getId();var n=t.getItems();var l=t._getIntervalStart(r);var d=t.getIntervalMinutes();var o="";var p=0;var c=[];var m=0;for(m=0;m<n;m++){p=i.format(l,true);if(c.length>0&&c[c.length-1].sDay==p){c[c.length-1].iItems++}else{c.push({sDay:p,iItems:1})}l.setUTCMinutes(l.getUTCMinutes()+d)}for(m=0;m<c.length;m++){var g=c[m];o=100/n*g.iItems+"%";e.openStart("div",s+"-Head"+m);e.class("sapUiCalHeadText");e.style("width",o);e.openEnd();e.text(g.sDay);e.close("div")}};n.renderTimes=function(e,t,a){var r=this.getHelper(t,a);var i=t.getItems();var s=100/i+"%";var n=t._getIntervalStart(a);var l="";var d="";for(var o=0;o<i;o++){if(r.oFormatTimeAmPm){d=r.oFormatTimeAmPm.format(n,true);if(l==d){d=""}else{l=d}}this.renderTime(e,t,n,r,s,d);n.setUTCMinutes(n.getUTCMinutes()+r.iMinutes)}};n.getHelper=function(t,a){var r={};r.sLocale=t._getLocale();r.oLocaleData=t._getLocaleData();r.oNow=e._createUniversalUTCDate(new Date,undefined,true);r.sCurrentTime=t._rb.getText("CALENDAR_CURRENT_TIME");r.sId=t.getId();r.oFormatLong=t._getFormatLong();r.oFormatTime=t._getFormatTime();r.oFormatTimeAmPm=t._oFormatTimeAmPm;r.iMinutes=t.getIntervalMinutes();var s=t.getLegend();if(s){var n=sap.ui.getCore().byId(s);if(n){if(!(n instanceof sap.ui.unified.CalendarLegend)){throw new Error(n+" is not an sap.ui.unified.CalendarLegend. "+t)}r.oLegend=n}else{i.warning("CalendarLegend "+s+" does not exist!",t)}}return r};n.renderTime=function(e,r,i,n,l,d){var o=r._getAriaRole();var p={role:o,selected:o!=="gridcell"?null:false,label:"",describedby:""};var c=r._oFormatYyyyMMddHHmm.format(i.getJSDate(),true);var m=r._checkDateSelected(i);var g=r._getDateType(i);var v=r._checkTimeEnabled(i);e.openStart("div",n.sId+"-"+c);e.class("sapUiCalItem");if(l){e.style("width",l)}var u=new t(i.getTime());u.setUTCMinutes(u.getUTCMinutes()+n.iMinutes);if(i.getTime()<=n.oNow.getTime()&&u.getTime()>n.oNow.getTime()){e.class("sapUiCalItemNow");p["label"]=n.sCurrentTime+" "}if(m>0){e.class("sapUiCalItemSel");if(o==="gridcell"){p["selected"]=true}}if(m==2){e.class("sapUiCalItemSelStart");p["describedby"]=p["describedby"]+" "+n.sId+"-Start"}else if(m==3){e.class("sapUiCalItemSelEnd");p["describedby"]=p["describedby"]+" "+n.sId+"-End"}else if(m==4){e.class("sapUiCalItemSelBetween")}else if(m==5){e.class("sapUiCalItemSelStart");e.class("sapUiCalItemSelEnd");p["describedby"]=p["describedby"]+" "+n.sId+"-Start";p["describedby"]=p["describedby"]+" "+n.sId+"-End"}if(g&&g.type!=s.None){e.class("sapUiCalItem"+g.type);if(g.tooltip){e.attr("title",g.tooltip)}}if(!v){e.class("sapUiCalItemDsbl");p["disabled"]=true}e.attr("tabindex","-1");e.attr("data-sap-time",c);p["label"]=p["label"]+n.oFormatLong.format(i,true);if(g&&g.type!=s.None){a.addCalendarTypeAccInfo(p,g.type,n.oLegend)}e.accessibilityState(null,p);e.openEnd();e.openStart("span");e.class("sapUiCalItemText");e.openEnd();e.text(n.oFormatTime.format(i,true));if(d){e.openStart("span");e.class("sapUiCalItemTextAmPm");e.openEnd();e.text(d);e.close("span")}e.close("span");e.close("div")};return n},true);